// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Supabase の接続 URL
}

// -------------------- Casts（キャスト） --------------------
model Cast {
  id         String   @id @default(uuid())
  name       String
  age        Int
  profile    String
  image_url  String
  created_at DateTime @default(now())

  // リレーション
  schedules     Schedule[]
  reviews       Review[]
  gallery_items GalleryItem[]
  profiles      CastProfile[]
  features      CastFeatures?
  memberships   CastStoreMembership[]
  video_casts   VideoCast[]
  badges        CastBadge[]
  blogs         Blog[]
}

// -------------------- Stores（店舗） --------------------
model Store {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  address     String
  phone       String?
  catch_copy  String?
  image_url   String?
  theme_color String?
  tags        String[]
  description String?
  created_at  DateTime @default(now())

  schedules        Schedule[]
  memberships      CastStoreMembership[]
  videos           Video[]
  recruit_pages    RecruitPage[]
  store_top_config StoreTopConfig?
  price_config     PriceConfig?

  @@map("stores")
}

// -------------------- Recruit Pages（採用ページ設定） --------------------
// -------------------- Recruit Pages（採用ページ設定） --------------------
model RecruitPage {
  id          String   @id @default(uuid())
  store_id    String
  section_key String
  content     Json
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  store Store @relation(fields: [store_id], references: [id])

  @@unique([store_id, section_key])
  @@map("recruit_pages")
}

// -------------------- Page Requests（ページ制作依頼） --------------------
model PageRequest {
  id            String   @id @default(uuid())
  title         String
  slug          String   @unique
  referenceUrls Json?    @default("[]")
  sections      Json?    @default("[]")
  status        String   @default("draft")
  thumbnailUrl  String?
  targetStoreSlugs String[] @default([])
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("page_requests")
}

// -------------------- Store Top Config（店舗トップページ設定） --------------------
model StoreTopConfig {
  id         String   @id @default(uuid())
  store_id   String   @unique
  config     Json // セクション設定をJSON形式で保存
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  store Store @relation(fields: [store_id], references: [id])

  @@map("store_top_configs")
}

// -------------------- Schedules（出勤予定） --------------------
model Schedule {
  id         String   @id @default(uuid())
  cast_id    String
  store_id   String
  work_date  DateTime
  start_time DateTime
  end_time   DateTime

  cast  Cast  @relation(fields: [cast_id], references: [id])
  store Store @relation(fields: [store_id], references: [id])
}

// -------------------- Reviews（口コミ） --------------------
model Review {
  id         String   @id @default(uuid())
  cast_id    String
  user_name  String
  rating     Int
  comment    String
  created_at DateTime @default(now())

  cast Cast        @relation(fields: [cast_id], references: [id])
  tags ReviewTag[]
}

// Review 用のタグ（例: イケメン, ユーモア）
model ReviewTag {
  id   String @id @default(uuid())
  name String @unique

  reviews Review[]
}

// -------------------- Gallery Items（ギャラリー画像） --------------------
model GalleryItem {
  id         String   @id @default(uuid())
  cast_id    String
  image_url  String
  caption    String?
  created_at DateTime @default(now())

  cast Cast @relation(fields: [cast_id], references: [id])
}

// -------------------- Cast Profiles（キャスト紹介文） --------------------
model CastProfile {
  id         String   @id @default(uuid())
  cast_id    String
  title      String
  content    String
  created_at DateTime @default(now())

  cast Cast @relation(fields: [cast_id], references: [id])
}

// -------------------- Features（特徴） --------------------
model FeatureMaster {
  id         String   @id @default(uuid())
  category   String
  name       String
  created_at DateTime @default(now())

  cast_personalities CastFeatures[] @relation("Personality")
  cast_appearances   CastFeatures[] @relation("Appearance")
  cast_mbtis         CastFeatures[] @relation("Mbti")
  cast_faces         CastFeatures[] @relation("Face")
}

model CastFeatures {
  id             String   @id @default(uuid())
  cast_id        String   @unique
  personality_id String?
  appearance_id  String?
  mbti_id        String?
  face_id        String?
  created_at     DateTime @default(now())

  cast        Cast           @relation(fields: [cast_id], references: [id])
  personality FeatureMaster? @relation("Personality", fields: [personality_id], references: [id])
  appearance  FeatureMaster? @relation("Appearance", fields: [appearance_id], references: [id])
  mbti        FeatureMaster? @relation("Mbti", fields: [mbti_id], references: [id])
  face        FeatureMaster? @relation("Face", fields: [face_id], references: [id])
}

// -------------------- Cast-Store Memberships（所属店舗） --------------------
model CastStoreMembership {
  id         String    @id @default(uuid())
  cast_id    String
  store_id   String
  is_primary Boolean   @default(false)
  start_date DateTime
  end_date   DateTime?
  created_at DateTime  @default(now())

  cast  Cast  @relation(fields: [cast_id], references: [id])
  store Store @relation(fields: [store_id], references: [id])
}

// -------------------- Badges（ステータス/バッジ） --------------------
model Badge {
  id   String @id @default(uuid())
  name String @unique

  cast_badges CastBadge[]
}

model CastBadge {
  id         String   @id @default(uuid())
  cast_id    String
  badge_id   String
  created_at DateTime @default(now())

  cast  Cast  @relation(fields: [cast_id], references: [id])
  badge Badge @relation(fields: [badge_id], references: [id])
}

// -------------------- Blogs（日記/ブログ） --------------------
model Blog {
  id         String   @id @default(uuid())
  cast_id    String
  title      String
  content    String
  created_at DateTime @default(now())

  cast   Cast        @relation(fields: [cast_id], references: [id])
  images BlogImage[]
  tags   BlogTag[]
}

model BlogImage {
  id        String @id @default(uuid())
  blog_id   String
  image_url String

  blog Blog @relation(fields: [blog_id], references: [id])
}

model BlogTag {
  id   String @id @default(uuid())
  name String

  blogs Blog[]
}

// -------------------- Videos（YouTube 動画まとめ） --------------------
model Video {
  id         String   @id @default(uuid())
  store_id   String
  url        String
  created_at DateTime @default(now())

  store    Store          @relation(fields: [store_id], references: [id])
  casts    VideoCast[]
  tags     VideoTag[]
  feelings VideoFeeling[]
}

model VideoCast {
  id       String @id @default(uuid())
  video_id String
  cast_id  String

  video Video @relation(fields: [video_id], references: [id])
  cast  Cast  @relation(fields: [cast_id], references: [id])
}

model VideoTag {
  id     String  @id @default(uuid())
  name   String
  videos Video[]
}

// 「癒されたい」「ときめきたい」など直感タグ
model VideoFeeling {
  id     String  @id @default(uuid())
  name   String
  videos Video[]
}

// -------------------- Recruit Applications（面接予約・応募者管理） --------------------
model RecruitApplication {
  id               String         @id @default(uuid())
  type             String // 'chatbot', 'quick', 'full'
  name             String
  phone            String?
  email            String?
  age              String?
  height           String?
  weight           String?
  address          String?
  message          String?
  store            String?
  status           String         @default("pending") // 'pending', 'contacted', 'interviewed', 'hired', 'rejected'
  simulationResult Json? // { income: number, personality: string }
  details          Json? // その他詳細な応募データ
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  photos           RecruitPhoto[]
}

model RecruitPhoto {
  id            String             @id @default(uuid())
  url           String
  applicationId String
  application   RecruitApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  createdAt     DateTime           @default(now())
}

// -------------------- Price Management（料金管理） --------------------

model PriceConfig {
  id             String   @id @default(uuid())
  store_id       String   @unique
  hero_image_url String?
  updated_at     DateTime @updatedAt
  created_at     DateTime @default(now())

  store           Store           @relation(fields: [store_id], references: [id], onDelete: Cascade)
  courses         Course[]
  transport_areas TransportArea[]
  options         PriceOption[]
  campaigns       Campaign[]

  @@map("price_configs")
}

model Course {
  id                    String   @id @default(uuid())
  price_config_id       String
  course_key            String
  name                  String
  description           String?
  icon                  String?
  extension_per_30min   Int      @default(6000)
  designation_fee_first Int      @default(1000)
  designation_fee_note  String?
  notes                 String?
  display_order         Int      @default(0)
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  price_config PriceConfig  @relation(fields: [price_config_id], references: [id], onDelete: Cascade)
  plans        CoursePlan[]

  @@map("courses")
}

model CoursePlan {
  id            String   @id @default(uuid())
  course_id     String
  minutes       Int
  price         Int
  sub_label     String?
  discount_info String?
  display_order Int      @default(0)
  created_at    DateTime @default(now())

  course Course @relation(fields: [course_id], references: [id], onDelete: Cascade)

  @@map("course_plans")
}

model TransportArea {
  id              String   @id @default(uuid())
  price_config_id String
  area            String
  price           Int?
  label           String
  note            String?
  display_order   Int      @default(0)
  created_at      DateTime @default(now())

  price_config PriceConfig @relation(fields: [price_config_id], references: [id], onDelete: Cascade)

  @@map("transport_areas")
}

model PriceOption {
  id              String   @id @default(uuid())
  price_config_id String
  name            String
  description     String?
  price           Int
  is_relative     Boolean  @default(false)
  display_order   Int      @default(0)
  created_at      DateTime @default(now())

  price_config PriceConfig @relation(fields: [price_config_id], references: [id], onDelete: Cascade)

  @@map("price_options")
}

model Campaign {
  id              String   @id @default(uuid())
  price_config_id String
  title           String
  description     String?
  image_url       String?
  need_entry      Boolean  @default(false)
  accent_text     String?
  price_info      String?
  display_order   Int      @default(0)
  created_at      DateTime @default(now())

  price_config PriceConfig @relation(fields: [price_config_id], references: [id], onDelete: Cascade)

  @@map("campaigns")
}
