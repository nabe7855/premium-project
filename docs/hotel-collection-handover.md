# ホテルデータ自動収集・インポート工程 引き継ぎ書

本資料は、外部サイトからのホテルデータ抽出（スクレイピング）、AIによるリライト、および本システムへの一括インポート作業を他のAIや担当者が継続するための手順書です。

## 1. 全体フロー

1.  **抽出**: `Playwright`スクリプトで大手ポータル（カップルズ等）から生のテキストデータを抽出。
2.  **リライト（外部AI）**: 抽出したJSONをChatGPT等の外部AIに渡し、当サイトのトーンに合わせた紹介文・口コミに変換。
3.  **登録**: 生成されたCSVを管理画面（`/admin/hotels`）からアップロードして一括登録。

## 2. スクレイピング（抽出フェーズ）

### 実行スクリプト

- `scripts/scrape_fukuoka_all.cjs`: 福岡全域（20エリア）を対象に詳細情報を抽出する最新スクリプト。
- `scripts/scrape_hakata.cjs`: 博多エリアに限定したテスト用スクリプト。

### 実行方法

```bash
node scripts/scrape_fukuoka_all.cjs
```

※完了すると `scraped_data_fukuoka_all.json` が生成されます。

### 注意事項

- **テキストのみ抽出**: 著作権の関係上、画像は抽出せず、紹介文や設備、料金、口コミの「テキスト」のみを対象としています。
- **レート制限**: 相手サイトへの負荷を避けるため、1リクエストごとに `1000ms` の待機時間を設けています。

## 3. AIによるリライト・CSV変換フェーズ

抽出したJSONをAI（ChatGPT/Claude等）に渡し、以下のプロンプトを使用してCSVを生成させます。

### AIへの推奨プロンプト

> 以下のJSONデータを元に、指定のCSVフォーマットへ変換してください。
>
> 【ルール】
>
> 1. descriptionは、生データから特徴（露天風呂、駅近、サービス等）を読み取り、150〜250文字で魅力的にリライトすること。
> 2. 料金は休憩・宿泊それぞれの最安値を数値で抽出すること。
> 3. 口コミはそのまま載せず、要約・リライトして1行ずつ出力すること。
>
> 【CSVヘッダー】
> hotel_id,hotel_name,address,phone,website,image_url,description,area_id,city_id,prefecture_id,min_price_rest,min_price_stay,rating,review_id,review_user,review_rating,review_content,review_date

## 4. インポート（登録フェーズ）

### 管理画面

- URL: `/admin/hotels`
- 機能: CSV選択・アップロード

### データ紐付けの仕様

- `hotel_id` が空の場合は「新規作成」、値がある場合は「既存データの更新」として処理されます。
- `prisma.$transaction` による一括処理のため、一部のエラーで全件ロールバックされる安全設計です。

## 5. 今後の拡張予定

- **全国対応**: `COUPLES_AREAS` 配列に他県のエリアIDを追加することで、全国のデータを収集可能です。
- **画像URLの参照**: 公式URLから画像パスのみを特定し、自社サーバーのパスにマッピングする処理の追加。

---

作成日: 2026-02-13
担当AI: Antigravity
